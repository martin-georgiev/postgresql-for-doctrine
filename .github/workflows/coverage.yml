name: Coverage

on:
  push:
    branches:
      - main
    paths-ignore:
      - '.github/actions/release-please/**'
  pull_request:
    branches:
      - main

permissions:
  contents: read
  checks: read
  actions: read

jobs:
  coverage:
    runs-on: ubuntu-latest
    steps:
      - name: Wait for Unit and Integration jobs
        uses: kachick/wait-other-jobs@755be1ff093bd2a6a82a24bfc50ef4d9fe491a59 # v3.8.1
        with:
          skip-same-workflow: 'true'
          wait-list: |
            [
              {"workflowFile": "integration-tests.yml"},
              {"workflowFile": "unit-tests.yml"}
            ]
        timeout-minutes: 15

      - if: ${{ steps.check.outputs.ready == 'true' }}
        name: Finalize Coveralls parallel build
        uses: coverallsapp/github-action@648a8eb78e6d50909eff900e4ec85cab4524a45b # v2
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          parallel-finished: true
          carryforward: "Integration,Unit"
